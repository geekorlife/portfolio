
<!DOCTYPE html>
<html>

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Pascal Game</title>
  <script>
    window.open    = function(){};
    window.print   = function(){};
    // Support hover state for mobile.
    if (false) {
      window.ontouchstart = function(){};
    }
  </script>
  <style>
    @font-face{
        font-family: digit;
        src: url(font/pusab-webfont.ttf);
    }
    body{
        margin:0;
        padding:0;
        background:white;
    }
    canvas{
        margin: auto;
        background: white;
        border-radius:10px;
    }
  </style>
</head>

<body>
<div style="font-family: digit;height:0px;display: none">Basketduel</div>
<div id="game" style="margin: auto; overflow: hidden;"></div>
  <script src='phaser.min.js'></script>
<script>
var game = new Phaser.Game(800, 420, Phaser.CANVAS, "game");
Game = {};
Game.Boot = function(e) {
};
Game.Boot.prototype = {
    preload: function() {
        this.load.image("cover", "images/loading.jpg");
        this.load.image("preloaderBar", "images/logo.png");
        this.load.tilemap('level3', 'images/tile.json', null, Phaser.Tilemap.TILED_JSON);
        this.load.tileset('tiles', 'images/tillesmin.png', 35, 35);
        this.load.tilemap('levelc', 'images/cloud.json', null, Phaser.Tilemap.TILED_JSON);
        this.load.tileset('cloud', 'images/cloud.png', 123, 66);
        this.load.tilemap('levelm', 'images/moutain.json', null, Phaser.Tilemap.TILED_JSON);
        this.load.tileset('mountain', 'images/moutain.png', 862, 210);
    },
    create: function() {
        this.game.state.start("Game");
 
    }
};
game.state.add("Boot", Game.Boot);
game.state.add("Game", this);
game.state.start("Boot");

function preload() {
        game.preloadBackground = game.add.sprite(0, 0, "cover");
        game.preloadBar = game.add.sprite(game.world.centerX-324.5, 270, "preloaderBar");
        game.load.setPreloadSprite(game.preloadBar);
    
        game.load.image('star', 'images/star_particle.png');
        game.load.image('starr', 'images/star_particler.png');
        game.load.image('starb', 'images/star_particleb.png');
        game.load.image('endpic', 'images/endpic.jpg');
        game.load.image('backct','images/court.jpg');
        game.load.image('ywin','images/ywin.png');
        game.load.image('myface','images/myface.png');
        game.load.image('savecss','images/savecss.png');
        game.load.image('savehtml','images/savehtml.png');
        game.load.image('pointe','images/pointe.png');
        game.load.image('savejs','images/savejs.png');
        game.load.image('keyb','images/keyb.jpg');
        game.load.image('title','images/title.jpg');
        game.load.image('lose','images/lose.jpg');
        game.load.image('title1','images/title1.jpg');
        game.load.image('okbtn', 'images/okbtn.png');
        game.load.image('playButton', 'images/play_btn.png');
        game.load.image('replay', 'images/replay.png');
        game.load.image('border','images/border.png');
        game.load.image('cpan','images/cpan.png');
        game.load.image('connect','images/basketball.png');
        game.load.image('grille','images/grille.png');
        game.load.spritesheet('photos', 'images/photos.png', 206, 200,6);
        game.load.spritesheet('adai', 'images/ai.png', 206, 200,6);
        game.load.spritesheet('aboutme', 'images/aboutme.png', 159, 97,6);
        game.load.spritesheet('html5', 'images/html5.png', 159, 97,6);
        game.load.spritesheet('js', 'images/js.png', 159, 97,6);
        game.load.spritesheet('pascal', 'images/pascalsprite.png', 97, 140);
        game.load.spritesheet('fallpascal', 'images/fallpascal.png', 150, 135);
        game.load.spritesheet('nage', 'images/nage.png', 135, 91);
        game.load.spritesheet('robot', 'images/robot.png', 66, 70);
        game.load.spritesheet('flame', 'images/flame.png', 32, 32);
        game.load.spritesheet('bullet', 'images/bullet.png', 30, 13);
        game.load.spritesheet('kaboom', 'images/explode.png', 128, 128);
        game.load.spritesheet('pascalide', 'images/pascalide.png', 97, 140);
        game.load.image('balle', 'images/balle.png');
        game.load.image('arrowr', 'images/arrowr.png');
        game.load.image('arrowl', 'images/arrowl.png');
        game.load.image('herbe', 'images/herbe.jpg');
        game.load.image('circLe', 'images/basketballbounsing.png');
        game.load.image('heart', 'images/heart.png');
    
}
var connect;
var photos;
var adai;
var keyb;
var myface;
var savecss;
var savejs;
var savehtml;
var back2;
var topb;
var herbe;
var mapm;
var tilesetm;
var layerm;
var mapc;
var tilesetc;
var layerc;
var map;
var tileset;
var losepart;
var layer;
var tileset1;
var layer1;
var tileset2;
var layer2;
var tileset3;
var layer3;
var tileset4;
var layer4;
var tileset5;
var layer5;
var grille;
var aboutme;
var htmlsprite;
var jssprite;
var botbeg;
var rot=false;
var desc=false;
var cilo=false;
var lcolis=false;
var panier;
var pascal;
var fallpascal;
var pascalide;
var arro;
var stateG=0;
var circLe;
var borDer;
var borDer2;
var speedy= 890;
var speedx= 400;
var text;
var text2;
var coeur;
var coeur2;
var coeur3;
var coeur4;
var title;
var playbtn;
var okbtn;
var ylose;
var ywin;
var cursor;
var acquireButton;
var bullet;
var robot;
var endpic;
var flame;
var arrowr;
var arrowl;
var rbullets;
var rbulletTime = 0;
var posPasX = 0;
var posPasY = 0;
var explode;
var robotmin;
var explosions;
var nage;
function rezGame() {
    game.world.setBounds(0, 0, 4200, 840);
    photos.x=4091;
    adai.x=4158;
    pascal.x = 100;
    pascal.y = 0;
    finWin=false;
    robot.revive();
    endflame=0;
    fireroOK=true;

}
function restartJeu(){
        console.log('restart');
        movePascal=true;
        photos.x=4091;
        adai.x=4158;
        replay.kill();
        losepart.kill();
        ywin.kill();
        endpic.kill();
        grille.y=-222;
        pascal.body.gravity.y = 20;
        heart(5);
        aboutme.animations.play('cage');
        htmlsprite.animations.play('cage');
        jssprite.animations.play('cage');
        //heart(5);
        pascallife=5;
        vitalAbm = 5;
        vitalHTML = 5;
        vitalJS = 5;
        vitalRobot = 10;
        aboutme.x=1000;
        aboutme.y=100;
        faboutme=false;
        aboutme.scale.setTo(1,1);
        htmlsprite.x=2100;
        htmlsprite.y=350;
        fhtmlsprite=false;
        htmlsprite.scale.setTo(1,1);
        jssprite.x=3200;
        jssprite.y=710;
        fjssprite=false;
        jssprite.scale.setTo(1,1);
        pascal.animations.play('idle');
        //game.camera.follow(pascal);  
}
function create() {
        game.preloadBackground.destroy();
        game.preloadBar.destroy();
        
        cursors = game.input.keyboard.createCursorKeys();
               
        title = game.add.sprite(0,0,'title');
        
        pascalide = game.add.sprite(game.world.centerX, game.world.centerY+10, 'pascalide');
        pascalide.anchor.setTo(0.5, 0.5);
        pascalide.animations.add('idle', [0, 1], 2, true);
        pascalide.animations.play('idle');
        
        playbtn = game.add.button(game.world.centerX - 134,300,'playButton',playOnClick, this, null, null, null);

        //game 
        acquireButton = game.input.keyboard.addKey(Phaser.Keyboard.Z);
       
        game.world.setBounds(0, 0, 4200, 840);
        
        back2 = game.add.tileSprite(0, 0, 4200, 840, 'title1');
        // TILEMAP
        
        mapc = game.add.tilemap('levelc');
        tilesetc = game.add.tileset('cloud');
        layerc = game.add.tilemapLayer(0,0,800,420,tilesetc,mapc,0);
        layerc.scrollFactorX= 0.2;
        
        mapm = game.add.tilemap('levelm');
        tilesetm = game.add.tileset('mountain');
        layerm = game.add.tilemapLayer(0,0,800,420,tilesetm,mapm,0);
        layerm.scrollFactorX= 0.35;
        
        map = game.add.tilemap('level3');
        tileset = game.add.tileset('tiles');
        layer = game.add.tilemapLayer(0,0,800,420,tileset,map,0);
        
        tileset1 = game.add.tileset('tiles');
        layer1 = game.add.tilemapLayer(0,0,800,420,tileset1,map,1);
        
        tileset2 = game.add.tileset('tiles');
        tileset2.setCollisionRange(0, tileset1.total - 1, true, true, true, true);
        layer2 = game.add.tilemapLayer(0,0,800,420,tileset2,map,2);
        
        tileset3 = game.add.tileset('tiles');
        layer3 = game.add.tilemapLayer(0,0,800,420,tileset2,map,3);
        
        tileset4 = game.add.tileset('tiles');
        layer4 = game.add.tilemapLayer(0,0,800,420,tileset4,map,4);
        
        tileset5 = game.add.tileset('tiles');
        layer5 = game.add.tilemapLayer(0,0,800,420,tileset5,map,5);   
        
        aboutme = game.add.sprite(1000, 100, 'aboutme');
        aboutme.animations.add('turn', [0, 1, 2], 8, true);
        aboutme.animations.add('cage', [3, 4, 5], 8, true);
        aboutme.body.immovable = true;
        htmlsprite = game.add.sprite(2100, 350, 'html5');
        htmlsprite.animations.add('turn', [0, 1, 2], 8, true);
        htmlsprite.animations.add('cage', [3, 4, 5], 8, true);
        htmlsprite.body.immovable = true;
        jssprite = game.add.sprite(3200, 710, 'js');
        jssprite.animations.add('turn', [0, 1, 2], 8, true);
        jssprite.animations.add('cage', [3, 4, 5], 8, true);
        jssprite.body.immovable = true;
        
        emitter = game.add.emitter(0, 0, 200);
        arrowl = [];
        arrowl = game.add.group();
        arrowl.createMultiple(30, 'arrowl');
        arrowl.setAll('anchor.x', 0.5);
        arrowl.setAll('anchor.y', 0.5);
        arrowl.setAll('outOfBoundsKill', true);
        arrowr = [];
        arrowr = game.add.group();
        arrowr.createMultiple(30, 'arrowr');
        arrowr.setAll('anchor.x', 0.5);
        arrowr.setAll('anchor.y', 0.5);
        arrowr.setAll('outOfBoundsKill', true);
        
        rbullets = [];
        rbullets = game.add.group();
        rbullets.createMultiple(30, 'balle');
        rbullets.setAll('anchor.x', 0.5);
        rbullets.setAll('anchor.y', 0.5);
        rbullets.setAll('outOfBoundsKill', true);
       
        pascal = game.add.sprite(400, game.world.centerY, 'pascal');
        pascal.anchor.setTo(0.5, 0.5);
        pascal.scale.setTo(0.5, 0.5);
        pascal.body.bounce.y = 0;
        pascal.body.collideWorldBounds = true;
        pascal.animations.add('left', [0, 1, 2, 3, 4], 6, true);
        pascal.animations.add('right', [7, 8, 9, 10, 11], 6, true);
        pascal.animations.add('idle', [5, 6], 2, true);
        pascal.animations.add('jump', [5], 1, false);
        pascal.animations.add('jumpr', [8], 1, false);
        pascal.animations.add('jumpl', [3], 1, false);
        pascal.animations.add('firel', [12, 13], 4, false);
        pascal.animations.add('firer', [15, 14], 4, false);
        pascal.animations.add('nage', [16, 17], 8, false);
        
        fallpascal = game.add.sprite(400, game.world.centerY, 'fallpascal');
        fallpascal.anchor.setTo(0.5, 0.5);
        fallpascal.scale.setTo(0.5, 0.5);
        fallpascal.body.bounce.y = 0;
        fallpascal.body.collideWorldBounds = true;
        fallpascal.animations.add('fall', [0, 1], 14, false);
        
        nage = game.add.sprite(400, game.world.centerY, 'nage');
        nage.anchor.setTo(0.5, 0.5);
        nage.scale.setTo(0.5, 0.5);
        nage.body.bounce.y = 0;
        nage.body.collideWorldBounds = true;
        nage.animations.add('nage', [0, 1], 10, false);
        
        robot = game.add.sprite(3980, 140, 'robot');
        robot.anchor.setTo(0.5, 0.5);
        robot.body.bounce.y = 0;
        robot.body.collideWorldBounds = true;
        robot.body.immovable = true;
        robot.animations.add('idle', [0, 1, 2, 3, 4,5], 6, true);
        robot.animations.play('idle');
        
        robotmin = game.add.sprite(2200, 800, 'pointe');
        robotmin.anchor.setTo(0.5, 0.5);
        robotmin.scale.setTo(0.5, 0.5);
        robotmin.body.bounce.y = 0;
        robotmin.body.collideWorldBounds = true;


        photos = game.add.sprite(0, 0, 'photos');
        photos.anchor.setTo(0.5, 0.5);
        photos.scale.setTo(0.4, 0.4);
        photos.y=0;
        photos.x=4050;
        photos.animations.add('idle', [0, 1, 2, 3], 4, true);
        photos.animations.add('jump', [4, 5], 4, false);
        photos.animations.play('idle');
        photos.body.gravity.y = 10;
        photos.body.bounce.y = 0;
        photos.body.collideWorldBounds = true;
        
        adai = game.add.sprite(0, 0, 'adai');
        adai.anchor.setTo(0.5, 0.5);
        adai.scale.setTo(0.4, 0.4);
        adai.y=0;
        adai.x=4160;
        adai.animations.add('idle', [0, 1, 2, 3], 4, true);
        adai.animations.add('jump', [4, 5], 4, false);
        adai.animations.play('idle');
        adai.body.gravity.y = 10;
        adai.body.bounce.y = 0;
        adai.body.collideWorldBounds = true;
        
        grille = game.add.sprite(4010,-222,'grille');
        grille.scale.setTo(0.5,0.5);
        flame = [];
        flame = game.add.group();
        flame.createMultiple(30, 'flame');
        flame.setAll('anchor.x', 0.5);
        flame.setAll('anchor.y', 0.5);
        flame.setAll('outOfBoundsKill', true);
        
        explode = game.add.sprite(-100,-100, 'kaboom');
        explode.anchor.setTo(0.5, 0.5);
        explode.scale.setTo(0.5, 0.5);
        explode.animations.add('explode', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15], 80, false);
        endpic = game.add.sprite(3400,0,'endpic');        
        myface = game.add.sprite(3500,200,'myface');
        savecss = game.add.sprite(0,0,'savecss');
        savehtml = game.add.sprite(0,0,'savehtml');
        savejs = game.add.sprite(0,0,'savejs');
        keyb = game.add.sprite(0,0, 'keyb');
        losepart = game.add.sprite(0,0, 'lose');
        ywin = game.add.sprite(0,0,'ywin');
        replay = game.add.button(game.world.centerX - 134,300,'replay',restartJeu, this, null, null, null);
        replay.anchor.setTo(0.5,0.5);
        fallpascal.kill();
        losepart.kill();
        replay.kill();
        keyb.kill();
        nage.kill();
        myface.kill();
        savecss.kill();
        endpic.kill();
        savehtml.kill();
        savejs.kill();
        ywin.kill();
        layer.kill();
        layer1.kill();
        pascal.kill();
        back2.kill();

        
}
function moveRobot() {
    if (robotmin.body.touching.right) {
        robotmin.body.velocity.x = -300;
    } else if (robotmin.body.touching.left) {
        robotmin.body.velocity.x = 300;
    }
}
function heart(x) {
    if (coeur) {
        coeur.destroy();
    }
    coeur = game.add.group();
    for (var i = 0; i < x; i++){
        var c = coeur.create(31*i, 15, 'heart');
        c.name = 'veg' + i;
        c.fixedToCamera = true;
        c.cameraOffset.setTo(30*i+2, 15);
    }
}

var temPo=1000;

function listener(){       
}
var cc=1;
var tails=false;
var doPan=true;
var hball;
var colPan=false;
function startJeu(){
        keyb.kill();
        stateG=1;
        //back2.fixedToCamera = false;
        aboutme.animations.play('cage');
        htmlsprite.animations.play('cage');
        jssprite.animations.play('cage');
        pascal.revive();
        heart(5);
        robotmin.body.velocity.x=300;
        moveRobot();
        layer.revive();
        layer1.revive();
        photos.y=0;
        adai.y=0;
        pascal.body.gravity.y = 20;
        pascal.animations.play('idle');
        //game.camera.follow(pascal);
        
}

var tgameTime = 0;
var contTime=0;
var starttcount=false;
function playOnClick(x){
        title.kill();
        pascalide.kill();
        playbtn.kill();
        back2.revive();
        keyb.revive();
        keyb.alpha = 0;
        game.add.tween(keyb).to({ alpha: 1 }, 250, Phaser.Easing.Linear.None)
            .to({ alpha: 1 }, 3000, Phaser.Easing.Linear.None)
            .to({ alpha: 0 }, 250, Phaser.Easing.Linear.None)
            .start();
        starttcount=true;
}
function lanjeu() {
    if (game.time.now > tgameTime){
        if (contTime==0) {
            tgameTime = game.time.now + 3500;
            contTime++;
        } else {
            startJeu();
        }
    }
}
var yyl=0;
var wll=0;
var endAni=false;
var xSca=0;
var replay;
function yLose(){
    movePascal=false;
    game.world.setBounds(0, 0, 800, 420);
    pascal.body.gravity.y = 0;
    heart(0);
    losepart.revive();
    replay.revive();
    replay.scale.setTo(1,1);
    replay.x=400;
    replay.y=330;
    losepart.x=0;
    losepart.y=0;
    losepart.alpha = 0;    
    game.add.tween(losepart).to({ alpha: 1 }, 250, Phaser.Easing.Linear.None)
            .to({ alpha: 1 }, 3000, Phaser.Easing.Linear.None)
            .start();
    rezGame();
}
function yWin() {
        movePascal=false;
        game.world.setBounds(0, 0, 800, 420);
        pascal.body.gravity.y = 0;
        heart(0);
        ywin.revive();
        ywin.anchor.setTo(0.5,0.5);
        ywin.scale.setTo(0,0);
        ywin.x=game.world.centerX;
        ywin.y=50;
        endpic.revive();
        replay.revive();
        replay.scale.setTo(0.8,0.8);
        replay.x=403;
        replay.y=370;
        endpic.x=0;
        endpic.y=0;
        endpic.alpha = 0;    
        game.add.tween(endpic).to({ alpha: 1 }, 250, Phaser.Easing.Linear.None)
            .to({ alpha: 1 }, 3000, Phaser.Easing.Linear.None)
            .start();
        game.add.tween(ywin.scale).to({ x: 1, y: 1},500, Phaser.Easing.Linear.None)
            .to({ x: 1, y: 1},500, Phaser.Easing.Linear.None)
            .start();
        rezGame();
    
    
}
var rttt = 0;
var tLeft = false;
var tRight = true;
var faboutme = false;
var fhtmlsprite = false;
var fjssprite = false;
var vitalAbm = 5;
var vitalHTML = 5;
var vitalJS = 5;
var vitalRobot = 10;
var finWin = false;
function kBuls(robot,rbullet){
        vitalRobot--;
        if (vitalRobot<0) {
            robot.kill();
            emitter.x = 3981;
            emitter.y = 152;
            emitter.makeParticles(['starb', 'star', 'starr']);
            emitter.start(true, 2000, null, 30);
            emitter.gravity.y = -200;
            fireroOK=false;
            endflame=1000000000;
            setTimeout(function(){finWin=true},300);
        }
        kBul(rbullet);
        setTimeout(function(){kexplod=true;},400);
}
function allrdE(aboutme,rbullet){
        vitalAbm--;
        if (vitalAbm<0) {
            aboutme.animations.play('turn');
            showskill(savecss);
            setTimeout(function(){faboutme=true;},400);
            emitter.x = 1100;
            emitter.y = 102;
            emitter.makeParticles(['starb', 'star', 'starr']);
            emitter.start(true, 2000, null, 30);
            emitter.gravity.y = -200;
        }
        kBul(rbullet);
        setTimeout(function(){kexplod=true;},400);
}
function allrdEHTML(aboutme,rbullet){
        vitalHTML--;
        if (vitalHTML<0) {
            htmlsprite.animations.play('turn');
            showskill(savehtml);
            setTimeout(function(){fhtmlsprite=true;},400);
            emitter.x = 2200;
            emitter.y = 352;
            emitter.makeParticles(['starb', 'star', 'starr']);
            emitter.start(true, 2000, null, 30);
            emitter.gravity.y = -200;
        }
        kBul(rbullet);
        setTimeout(function(){kexplod=true;},400);
}
function showskill(skill) {
    if (skill==savecss) {
        var haut=0;
    } else if (skill==savehtml) {
        var haut=200;
    } else {
        var haut=400;
    }
    skill.revive();
    skill.anchor.setTo(0.5, 0.5);
    skill.x=pascal.x;
    skill.y=game.world.centerY-200+haut;
    skill.alpha = 0;
    game.add.tween(skill).to({ alpha: 1 }, 500, Phaser.Easing.Linear.None)
    .to({ alpha: 1 }, 2300, Phaser.Easing.Linear.None)
    .to({ alpha: 0 }, 500, Phaser.Easing.Linear.None)
    .start();
}
function allrdEJS(aboutme,rbullet){
        vitalJS--;
        if (vitalJS<0) {
            jssprite.animations.play('turn');
            showskill(savejs);
            setTimeout(function(){fjssprite=true;},400);
            emitter.x = 3300;
            emitter.y = 712;
            emitter.makeParticles(['starb', 'star', 'starr']);
            emitter.start(true, 2000, null, 30);
            emitter.gravity.y = -200;
        }
        kBul(rbullet);
        setTimeout(function(){kexplod=true;},400);
}
function collisionHandler(){
    console.log('col');
}
var kexplod = false;
function kBul(rbullet) {
        explode.kill();
        explode.revive();
        if (tLeft) {
            explode.body.x = rbullet.body.x-40;
        } else {
            explode.body.x = rbullet.body.x+20;
        }        
        explode.body.y = rbullet.body.y-30;
        explode.animations.play('explode');
        
        //  And create an explosion :)
        rbullet.kill();
        setTimeout(function(){kexplod=true;},400);
}
var kexplodf;
function kBulf(pascal,sflame) {
    plife();
        explode.kill();
        explode.revive();
        explode.body.x = sflame.body.x-40;
        explode.body.y = sflame.body.y-30;
        explode.animations.play('explode');
        //  And create an explosion :)
        sflame.kill();
        setTimeout(function(){kexplodf=true;},400);
}
function fBul(sflame) {
        sflame.kill();
}
function karrl(arrol){
        arrol.kill();
}
function karrr(arror){
        arror.kill();
}
var bulletTime = 0;
function fireBulleTs() {
    if (game.time.now > rbulletTime && rbullets.countDead() > 0){
        var rbullet = rbullets.getFirstExists(false);
        if (rbullet){
            if (tRight) {
                rbullet.reset(pascal.x + 3, pascal.y);
                rbullet.body.velocity.x = +500;
            } else if (tLeft) {
                rbullet.reset(pascal.x - 20, pascal.y);
                rbullet.body.velocity.x = -500;
            }
            rbulletTime = game.time.now + 500;
        }
    }
}
var arrTime = 0;
var arlTime = 0;
function firearrowr() {
    if (game.time.now > arrTime && arrowr.countDead() > 0){
        var arror = arrowr.getFirstExists(false);
        if (arror){
                arror.reset(3670, 407);
                arror.body.velocity.x = +500;
                arrTime = game.time.now + 2000;
        }
    }
}

function firearrowl() {
    if (game.time.now > arlTime && arrowl.countDead() > 0){
        var arrol = arrowl.getFirstExists(false);
        if (arrol){
                arrol.reset(3990, 330);
                arrol.body.velocity.x = -500;
                arlTime = game.time.now + 2000;
        }
    }
}
var endflame=0;
var fireroOK=true;
function firerobot() {
    if (game.time.now > endflame && flame.countDead() > 0 && fireroOK){
        var sflame = flame.getFirstExists(false);
        if (sflame){
                sflame.reset(3941, 136);
                sflame.body.velocity.x = -400;
                endflame = game.time.now + 2000;
        }
    }
}
function backPascal() {
    pascal.body.x=3500;
    pascal.body.y=0;
}
function resetBulletr(){
    rbullet.kill();
    console.log('kill rocket');
}
var jpm=0;
function jumpAd() {
    if (jpm==0) {
        photos.body.gravity.y = 20;
        adai.body.gravity.y = 20;
        photos.animations.play('jump');
        adai.animations.play('jump');
        setTimeout(function(){photos.body.velocity.y = -300;},100);
        setTimeout(function(){adai.body.velocity.y = -300;},10);
        jpm++;
    } else {
        jpm++;
        if (jpm==40) {
            jpm=0;
        }
    }
}
function finJeu(){
    yWin();
}
var pascallife=5;
var loselife=true;
var movePascal=true;
var focuspascal=true;

function plife(){
    if (loselife) {
        pascallife--;
        if (pascallife==0) {
            yLose();
        } else {
            if (pascal.body.touching.left) {
                fallpascal.scale.x = -0.5;
                robotmin.body.velocity.x=300;
            } else if(pascal.body.touching.right) {
                fallpascal.scale.x = 0.5;
                robotmin.body.velocity.x=-300;
            }
            movePascal=false;
            heart(pascallife);
            loselife=false;
            fallpascal.revive();
            focuspascal=false;
            game.camera.focusOnXY(fallpascal.x,fallpascal.y);
            fallpascal.body.gravity.y = 20;
            fallpascal.x = pascal.x;
            fallpascal.y = pascal.y;
            pascal.kill();
            fallpascal.animations.play('fall');
            fallpascal.body.velocity.x=0;
            pascal.body.velocity.x=0;
            fallpascal.alpha=1;
            
            game.add.tween(fallpascal).to({ alpha: 0 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 1 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 0 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 1 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 0 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 1 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 0 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 1 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 0 }, 50, Phaser.Easing.Linear.None)
                .to({ alpha: 1 }, 50, Phaser.Easing.Linear.None)
                .start();
            setTimeout(function(){
                loselife=true;
                pascal.angle=0;
                movePascal=true;
                pascal.revive();
                focuspascal=true;
                pascal.x=fallpascal.x;
                pascal.y=fallpascal.y;
                fallpascal.scale.x=0.5;
                fallpascal.kill();
                },1000);
        }
    } 
}
var nageP=false;
function nagePascal(){
    console.log('nage');
    nageP=true;
    pascal.animations.play('nage');
    if (tLeft) {
        pascal.scale.x = -0.5;
    } else if (tRight) {
        pascal.scale.x = 0.5;
    }
}
function update() {
        //console.log(pascal.body.x);
      if (stateG==0) {
        //waiting screen
        if(starttcount){
            lanjeu();
        };
      } else if (stateG==1) {
        moveRobot();
        if (!focuspascal) {
            game.camera.focusOnXY(fallpascal.x,fallpascal.y);
        } else if(focuspascal){
            game.camera.focusOnXY(pascal.x,pascal.y);
        }
        if (finWin) {
            jumpAd();
            if (grille.y <= -400) {
                endAni=true;
                //setTimeout(function(){stateG=2},300);
            } else {
                grille.y-=2;
            }
        }
        //pos friend
        if (kexplod==true) {
            explode.kill();
            kexplod=false;
        }
        if (kexplodf==true) {
            explode.kill();
            kexplodf=false;
        }
        if (faboutme && tLeft) {
            aboutme.scale.setTo(0.5, 0.5);
            aboutme.x = pascal.x;
            aboutme.y = pascal.y-40;
        } else if (faboutme && tRight) {
            aboutme.scale.setTo(0.5, 0.5);
            aboutme.x = pascal.x-70;
            aboutme.y = pascal.y-40;
        }
        if (fhtmlsprite && tLeft) {
            htmlsprite.scale.setTo(0.5, 0.5);
            htmlsprite.x = pascal.x;
            htmlsprite.y = pascal.y-60;
        } else if (fhtmlsprite && tRight) {
            htmlsprite.scale.setTo(0.5, 0.5);
            htmlsprite.x = pascal.x-70;
            htmlsprite.y = pascal.y-60;
        }
        if (fjssprite && tLeft) {
            jssprite.scale.setTo(0.5, 0.5);
            jssprite.x = pascal.x;
            jssprite.y = pascal.y-80;
        } else if (fjssprite && tRight) {
            jssprite.scale.setTo(0.5, 0.5);
            jssprite.x = pascal.x-70;
            jssprite.y = pascal.y-80;
        }
        game.physics.collide(pascal,layer);
        game.physics.collide(fallpascal,layer);
        game.physics.collide(pascal,layer1);
        game.physics.collide(fallpascal,layer1);
        //game.physics.overlap(layer5,pascal, nagePascal,null,this);
        //game.physics.overlap(pascal,layer5, nagePascal,null,this);
        game.physics.collide(pascal,layer2, backPascal, null, this);
        game.physics.collide(pascal,photos, finJeu, null, this);
        game.physics.collide(pascal,robotmin, plife, null, this);
        game.physics.collide(adai,layer);
        game.physics.collide(adai,layer1);
        game.physics.collide(adai,layer2);
        game.physics.collide(photos,layer);
        game.physics.collide(photos,layer1);
        game.physics.collide(photos,layer2);
        
        game.physics.collide(robotmin,layer1, moveRobot, null, this);
        game.physics.collide(robotmin,layer2, moveRobot, null, this);
        
        game.physics.collide(rbullets,robot, kBuls, null,this);
        game.physics.collide(flame,pascal, kBulf, null,this);
        game.physics.collide(rbullets,layer, kBul, null,this);
        game.physics.collide(rbullets,layer1, kBul, null,this);
        game.physics.collide(aboutme,rbullets, allrdE, null,this);
        game.physics.collide(htmlsprite,rbullets, allrdEHTML, null,this);
        game.physics.collide(jssprite,rbullets, allrdEJS, null,this);
        pascal.body.velocity.x = 0;
        
        game.physics.collide(arrowl,layer, karrl, null,this);
        game.physics.collide(arrowl,layer1, karrl, null,this);
        game.physics.collide(arrowr,layer, karrr, null,this);
        game.physics.collide(arrowr,layer1, karrr, null,this);
        game.physics.collide(flame,layer3, fBul, null,this);
        
        game.physics.collide(pascal,arrowl, plife, null,this);
        game.physics.collide(pascal,arrowr, plife, null,this);
        firearrowl();
        firearrowr();
        firerobot();

        if (cursors.left.isDown && pascal.body.touching.down && movePascal) {
            pascal.body.velocity.x = -200;
            tLeft = true;
            tRight = false;
            if(pascal.body.touching.down && !nageP){
                pascal.animations.play('left');
            }
        } else if (cursors.right.isDown && pascal.body.touching.down && movePascal) {
            pascal.body.velocity.x = 200;
            tLeft = false;
            tRight = true;
            if(pascal.body.touching.down && !nageP){
                pascal.animations.play('right');
            }
        } else if (cursors.right.isDown && !pascal.body.touching.down && movePascal) {
            pascal.body.velocity.x = 200;
            if (!nageP) {
                pascal.animations.play('jumpr');
            }            
            tLeft = false;
            tRight = true;
        } else if (cursors.left.isDown && !pascal.body.touching.down && movePascal) {
            pascal.body.velocity.x = -200;
            if (!nageP) {
                pascal.animations.play('jumpl');
            }
            tLeft = true;
            tRight = false;          
        } else if (tLeft && pascal.body.touching.down && acquireButton.isDown && movePascal)        {
            //  Move to the right
            pascal.animations.play('firel');
            fireBulleTs();
            //if (game.time.now > bulletTime){
                //  Grab the first bullet we can from the pool
              //  bullet = new myBullet(pascal.body.x+13,pascal.body.y+35,'left');
                //bulletTime = game.time.now + 500;                
            //}
        } else if (tRight && pascal.body.touching.down && acquireButton.isDown && movePascal)        {
            //  Move to the right
            pascal.animations.play('firer');
            fireBulleTs();
            
        } else {
            if (!nageP) {
                 pascal.animations.play('idle');
            }           
            
        }
        //  Allow the player to jump if they are touching the ground.
        if (cursors.up.isDown && pascal.body.touching.down && movePascal){
            //pascal.animations.play('jump');
            pascal.body.velocity.y = -700;
        }
      } else if (stateG==2) {
        yWin();
      } else if (stateG==3) {
        yLose();
      }
}
function render () {

    //game.debug.renderQuadTree(game.physics.quadTree);
    //game.debug.renderSpriteInfo(player.ball, 32, 32);
    //game.debug.renderSpriteCollision(player.ball, 32, 400);
    //game.debug.renderSpriteCollision(ground, 32, 400);
 
}

</script>
</body>
</html>